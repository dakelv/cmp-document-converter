<!DOCTYPE html>
<html>
<head>
    <title>Debug Authentication</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; }
        .test-button { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .code-test { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>🔍 Authentication Debug</h1>
    <div id="results"></div>
    
    <div style="margin: 20px 0;">
        <button class="test-button" onclick="testClientAuth()">🧪 Test Client-Side Auth</button>
        <button class="test-button" onclick="testServerAuth()">🌐 Test Server Auth</button>
        <button class="test-button" onclick="testPasswordDialog()">🔐 Test Password Dialog</button>
        <button class="test-button" onclick="clearAndTestMain()">🧹 Clear & Test Main</button>
    </div>
    
    <script src="js/auth-client-side.js"></script>
    <script src="js/cmp-doc-converter-config.js"></script>
    <script src="js/cmp-doc-converter-main.js"></script>
    
    <script>
        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            document.getElementById('results').appendChild(div);
        }
        
        function testClientAuth() {
            addResult('🔍 Testing client-side authentication...', 'info');
            
            if (typeof window.cmpAuth === 'undefined') {
                addResult('❌ window.cmpAuth is not defined', 'error');
                return;
            }
            
            addResult('✅ window.cmpAuth is loaded', 'success');
            
            const testCodes = ['J1an9xi!', 'CMP-2025', 'Test-2025', 'invalid-code'];
            
            testCodes.forEach(code => {
                const result = window.cmpAuth.validateCode(code);
                const type = result ? 'success' : 'error';
                const icon = result ? '✅' : '❌';
                addResult(`${icon} Code "${code}": ${result ? 'VALID' : 'INVALID'}`, type);
            });
        }
        
        async function testServerAuth() {
            addResult('🌐 Testing server-side authentication...', 'info');
            
            if (typeof validateCodeServerSide === 'undefined') {
                addResult('❌ validateCodeServerSide function not found', 'error');
                return;
            }
            
            const testCodes = ['J1an9xi!', 'CMP-2025', 'Test-2025'];
            
            for (const code of testCodes) {
                try {
                    const result = await validateCodeServerSide(code);
                    const type = result ? 'success' : 'error';
                    const icon = result ? '✅' : '❌';
                    addResult(`${icon} Server validation "${code}": ${result ? 'VALID' : 'INVALID'}`, type);
                } catch (error) {
                    addResult(`❌ Server validation "${code}": ERROR - ${error.message}`, 'error');
                }
            }
        }
        
        async function testPasswordDialog() {
            addResult('🔐 Testing password dialog...', 'info');
            
            try {
                const code = await showPasswordDialog();
                if (code) {
                    addResult(`✅ Password dialog returned: "${code}"`, 'success');
                    
                    // Test the code
                    if (window.cmpAuth && window.cmpAuth.validateCode(code)) {
                        addResult(`✅ Code "${code}" is VALID`, 'success');
                    } else {
                        addResult(`❌ Code "${code}" is INVALID`, 'error');
                    }
                } else {
                    addResult('❌ Password dialog cancelled or empty', 'error');
                }
            } catch (error) {
                addResult(`❌ Password dialog error: ${error.message}`, 'error');
            }
        }
        
        function clearAndTestMain() {
            addResult('🧹 Clearing authentication...', 'info');
            localStorage.removeItem('cmp_access_code');
            if (window.cmpAuth) {
                window.cmpAuth.clearAuthentication();
            }
            addResult('✅ Authentication cleared', 'success');
            addResult('🚀 Opening main app in 2 seconds...', 'info');
            setTimeout(() => {
                window.open('cmp-doc-converter.html', '_blank');
            }, 2000);
        }
        
        // Auto-test on load
        window.onload = function() {
            addResult('🚀 Starting authentication debug...', 'info');
            setTimeout(() => {
                testClientAuth();
            }, 500);
        };
    </script>
</body>
</html></text>
</invoke>